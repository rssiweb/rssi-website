<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-11316670180"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'AW-11316670180');
    </script>
    <meta name="description"
        content="Visit RSSI NGO to learn more about our programs, initiatives, and community impact. Get directions, contact information, and plan your visit to our centre.">
    <meta name="keywords"
        content="RSSI NGO visit, NGO centre visit, RSSI NGO location, NGO programs, community initiatives, NGO contact information">
    <meta name="author" content="RSSI NGO">
    <meta property="og:image" content="https://rssi.in/img/og_image.png">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>RSSI NGO - visitor Form</title>
    <link rel="shortcut icon" href="../img/favicon.ico" type="image/x-icon" />
    <!-- Bootstrap CSS -->
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- Template Main CSS File -->
    <link href="/css/main.css?v=7.0.0" rel="stylesheet">
    <style>
        .required-asterisk {
            color: red;
        }
    </style>

    <style>
        /* Optional styling for better appearance */
        #pauseTimerBtn {
            width: 32px;
            height: 32px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            z-index: 1;
        }

        #pauseTimerBtn:hover {
            transform: scale(1.1);
            transition: transform 0.2s;
        }

        #alertTimer {
            font-size: 0.7rem;
            min-width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-close {
            position: relative;
        }

        /* Mini notification styles */
        .mini-notification {
            position: relative;
            margin-top: 10px;
            animation-duration: 0.5s;
        }

        #expandNotificationBtn {
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        #expandNotificationBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        /* Animation classes */
        .animate__animated {
            animation-duration: 0.5s;
        }

        .animate__fadeIn {
            animation-name: fadeIn;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Make alert position relative for absolute positioning */
        #visitorAlert {
            position: relative;
        }
    </style>

    <!-- Add Animate.css for smooth animations (optional) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">

</head>

<body>
    <!-- ======= Header ======= -->
    <div id="header"></div>
    <!-- End Header -->
    <main id="main">
        <!-- ======= Breadcrumbs ======= -->
        <!-- Replace your existing breadcrumbs div with this -->
        <div class="breadcrumbs">
            <div class="container">
                <div class="d-flex justify-content-between align-items-center">
                    <h2 id="page-title"></h2>
                    <ol id="breadcrumb-list"></ol>
                </div>
            </div>
        </div>

        <!-- End Breadcrumbs -->
        <section class="sample-page">
            <div class="container">
                <div class="container mt-3">
                    <!-- Main Alert (will collapse to icon) -->
                    <div class="alert alert-primary alert-dismissible fade show" role="alert" id="visitorAlert">
                        <h2 class="alert-heading">
                            <i class="bi bi-shield-check me-2"></i>Visitor Registration Requirement
                        </h2>

                        <p class="mt-3 mb-2">
                            All first-time visitors to RSSI must complete the <strong>Visit Us Form</strong> prior to
                            visiting the centre for any official, administrative, or non-routine purpose.
                        </p>

                        <p class="mb-2">
                            Submission of a valid government-issued photo ID is required for identity verification and
                            to help maintain a safe and secure environment.
                        </p>

                        <hr>

                        <p class="mb-0">
                            Returning visitors who have previously completed the Visit Us Form can simply book their
                            visit using their registered mobile number.
                        </p>

                        <!-- Close button with timer and pause button -->
                        <div class="position-absolute top-0 end-0 m-3 d-flex align-items-center gap-2">
                            <!-- Pause Button -->
                            <button type="button" class="btn btn-sm btn-outline-light" id="pauseTimerBtn"
                                data-paused="false" title="Pause timer">
                                <i class="bi bi-pause" id="pauseIcon"></i>
                            </button>

                            <!-- Close button with timer -->
                            <div class="position-absolute top-0 end-0 m-3">
                                <span id="alertTimer" class="badge rounded-pill bg-primary"
                                    style="padding: 8px 12px; font-size: 0.9rem;">
                                    10
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Mini Notification Icon (hidden initially) -->
                    <div class="mini-notification text-end" id="miniNotification" style="display: none;">
                        <button type="button" class="btn btn-primary btn-sm rounded-pill" id="expandNotificationBtn"
                            title="Show visitor information">
                            <i class="bi bi-info-circle me-1"></i> Visitor Info
                            <span class="badge bg-white text-primary ms-1" id="notificationBadge">!</span>
                        </button>
                    </div>
                </div>


                <!-- Part 1: visitor Information -->
                <form action="#" method="POST" name="visitorInfoForm" id="visitorInfoForm"
                    enctype="multipart/form-data">
                    <input type="hidden" name="form-type" value="visitor_form">
                    <div class="mb-3">
                        <label for="visitorType" class="form-label">Have you
                            visited earlier?</label>
                        <select class="form-select" id="visitorType" name="visitorType"
                            onchange="togglevisitorSections()" required>
                            <option value>Select</option>
                            <option value="new">No, I am a first-time
                                visitor</option>
                            <option value="existing">Yes, I have visited
                                earlier</option>
                        </select>
                    </div>
                    <div id="existingvisitorInfo" style="display: none;">
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" id="contactnumber_verify"
                                name="contactnumber_verify" pattern="[0-9]{10}" placeholder="Enter your contact number"
                                oninput="validateContactNumber(this)">
                            <button type="submit" class="btn btn-primary" id="verifybutton">Find your details</button>
                        </div>
                        <span id="contactnumber_error" style="color: red;"></span>
                    </div>

                    <script>
                        function validateContactNumber(input) {
                            var errorMessage = document.getElementById("contactnumber_error");
                            var verifyButton = document.getElementById("verifybutton");

                            if (!input.checkValidity()) {
                                errorMessage.textContent = "Please enter a valid 10-digit contact number.";
                                verifyButton.disabled = true;
                            } else {
                                errorMessage.textContent = "";
                                verifyButton.disabled = false;
                            }
                        }
                    </script>

                    <!-- Get user data -->
                    <div id="verificationResult" style="display: none;">
                        <input type="hidden" id="tel" name="tel" class="form-control" readonly>
                        <div class="mb-3">
                            <label for="visitorName" class="form-label">Visitor Name</label>
                            <input type="text" id="visitorName" class="form-control" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="visitorEmail" class="form-label">Email Address</label>
                            <input type="email" id="visitorEmail" class="form-control" readonly>
                        </div>
                    </div>

                    <!-- New visitor Information -->
                    <div id="newvisitorInfo" style="display: none;">
                        <div class="mb-3">
                            <label for="fullName" class="form-label">Full
                                Name</label>
                            <input type="text" class="form-control" id="fullName" name="fullName" required>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">Email
                                Address</label>
                            <input type="email" class="form-control" id="email" name="email" required>
                        </div>

                        <div class="mb-3">
                            <label for="contactNumberNew" class="form-label">Contact Number</label>
                            <input type="tel" class="form-control" id="contactNumberNew" name="contactNumberNew"
                                pattern="[0-9]{10}" required>
                            <small id="type-of-admission-help" class="form-text text-muted">Enter a WhatsApp number to
                                receive application process alerts.</small><br>
                            <small id="contactNumberError" class="form-text text-danger"></small>
                        </div>

                        <script>
                            function validateInput() {
                                document.getElementById('contactNumberError').textContent = this.validity.patternMismatch ? 'Please enter a valid 10-digit number.' : '';
                            }

                            const inputElement = document.getElementById('contactNumberNew');
                            inputElement.addEventListener('input', validateInput);
                        </script>

                        <div class="mb-3">
                            <label for="idType" class="form-label">Select Government Photo ID Type</label>
                            <select class="form-select" id="idType" name="idType" required>
                                <option value="" selected disabled>Choose ID type...</option>
                                <option value="aadhar">Aadhar Card</option>
                                <option value="driving_license">Driving License</option>
                                <option value="pan">PAN Card</option>
                                <option value="voter">Voter ID Card</option>
                                <option value="passport">Passport</option>
                                <option value="other">Other Government ID</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="idNumber" class="form-label">ID Number</label>
                            <input type="text" class="form-control" id="idNumber" name="idNumber"
                                placeholder="Enter your ID number" required>
                            <div class="form-text" id="idNumberHelp">
                                Please enter the number from your selected ID document
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="governmentId" class="form-label">Upload Selected ID</label>
                            <input type="file" class="form-control" id="governmentId" name="governmentId"
                                accept=".pdf,.jpg,.jpeg,.png,.heic" onchange="compressImageBeforeUpload(this)" required>
                            <div class="form-text">
                                Please upload a clear photo/scan of your selected government-issued photo ID.
                                Accepted formats: PDF, JPG, PNG, HEIC (Max size: 5MB)
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="photo" class="form-label">Upload
                                Photo</label>
                            <input type="file" class="form-control" id="photo" name="photo" required
                                accept="image/*;capture=camera" onchange="compressImageBeforeUpload(this)">
                            <img src="/img/photo_guide.jpg" alt="Uploaded Photo"
                                style="max-width: 200px; max-height: 200px;">
                        </div>
                    </div>

                    <!-- visitor Amount -->
                    <div id="visitinfo" style="display: none;">

                        <div class="mb-3">
                            <label for="visitbranch" class="form-label">Which branch do you want
                                to visit?</label>
                            <div class="input-group">
                                <select class="form-select" id="visitbranch" name="visitbranch" required>
                                    <option value disabled selected>Select
                                        Branch</option>
                                    <option value="Gomti Nagar, Lucknow">Gomti
                                        Nagar, Lucknow</option>
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="visitstartdatetime" class="form-label">Visit start date</label>
                                    <input type="datetime-local" class="form-control" id="visitstartdatetime"
                                        name="visitstartdatetime" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="visitenddate" class="form-label">Visit end date</label>
                                    <input type="date" class="form-control" id="visitenddate" name="visitenddate"
                                        required>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="visitpurpose" class="form-label">Purpose of visit</label>
                            <div class="form-check">
                                <input type="radio" class="form-check-input" id="college_project" name="visitpurpose"
                                    value="College/University project as a part of community service" required>
                                <label for="college_project">College/University
                                    project as a part of community
                                    service</label>
                            </div>
                            <div class="form-check">
                                <input type="radio" class="form-check-input" id="other" name="visitpurpose"
                                    value="Other">
                                <label for="other">Other</label>
                                <textarea class="form-control" id="other_reason" name="other_reason"
                                    placeholder="Please specify reason" style="display: none;"></textarea>
                            </div>
                        </div>

                        <div class="mb-3" id="additionalFields" style="display: none;">
                            <div class="mb-3">
                                <label for="institutename" class="form-label">Institute Name</label>
                                <input type="text" class="form-control" id="institutename" name="institutename"
                                    required>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="enrollmentnumber" class="form-label">Enrollment Number</label>
                                        <input type="text" class="form-control" id="enrollmentnumber"
                                            name="enrollmentnumber" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="instituteid" class="form-label">Institute ID</label>
                                        <input type="file" class="form-control" id="instituteid" name="instituteid"
                                            accept=".pdf,.doc,.docx" onchange="compressImageBeforeUpload(this)"
                                            required>
                                        <small id="type-of-admission-help" class="form-text text-muted">Please upload a
                                            copy of your college ID or any other document that shows your student ID or
                                            enrollment number.</small>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="mentoremail" class="form-label">Mentor Email</label>
                                <input type="email" class="form-control" id="mentoremail" name="mentoremail" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">
                                    Additional Services (Optional)
                                </label>
                                <small class="text-muted d-block mb-2">
                                    Base services included with the application are applied by default.
                                    Charges for selected additional services are listed below.
                                </small>

                                <!-- Certificate -->
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" name="additional_services[]"
                                        id="service_certificate" value="certificate">
                                    <label class="form-check-label" for="service_certificate">
                                        Certificate / Acknowledgment Letter
                                    </label>
                                </div>

                                <!-- Interview -->
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" name="additional_services[]"
                                        id="service_interview" value="interview" onchange="toggleInterviewDuration()">
                                    <label class="form-check-label" for="service_interview">
                                        Interview with Centre In-Charge or Teachers
                                    </label>
                                </div>

                                <div class="mb-3" id="interview_duration_container" style="display:none;">
                                    <label for="interview_duration" class="form-label">Duration (minutes)</label>
                                    <input type="number" min="1"
                                        class="form-control form-control-sm w-auto d-inline-block"
                                        name="interview_duration" id="interview_duration" value="30"
                                        style="width: 80px;">
                                </div>

                                <!-- Videography -->
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" name="additional_services[]"
                                        id="service_video" value="videography" onchange="toggleCameraCount()">
                                    <label class="form-check-label" for="service_video">
                                        Videography (personal camera or mobile)
                                    </label>
                                </div>

                                <div class="mb-3" id="camera_count_container" style="display:none;">
                                    <label for="camera_count" class="form-label">Number of cameras / devices</label>
                                    <input type="number" min="1"
                                        class="form-control form-control-sm w-auto d-inline-block" name="camera_count"
                                        id="camera_count" value="1" style="width: 80px;">
                                </div>
                            </div>

                            <div class="alert alert-warning">
                                <i class="bi bi-info-circle me-2"></i>
                                <small>
                                    Payment details and the payment link are provided below. <strong>Completing the
                                        payment alone does not confirm your visit slot.</strong>
                                    After making the payment, please download the payment receipt and upload it below
                                    before submitting the form.
                                    Requests with unverified or incorrect payment information will be <strong>cancelled
                                        or marked invalid</strong>.
                                </small>
                            </div>

                            <div class="mb-3">
                                <label for="paymentdoc" class="form-label">Payment Receipt</label>
                                <input type="file" class="form-control" id="paymentdoc" name="paymentdoc"
                                    accept=".pdf,.doc,.docx" onchange="compressImageBeforeUpload(this)" required>
                                <small id="type-of-admission-help" class="form-text text-muted">Upload proof of payment
                                    (receipt or screenshot)</small>
                            </div>

                            <!-- Fee Structure Tabs -->
                            <div class="mt-4">
                                <ul class="nav nav-tabs" id="visitorTypeTab" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="individual-tab" data-bs-toggle="tab"
                                            data-bs-target="#individual" type="button" role="tab"
                                            aria-controls="individual" aria-selected="true">
                                            <i class="bi bi-person me-2"></i>Individual / Small Group (1-10)
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="largegroup-tab" data-bs-toggle="tab"
                                            data-bs-target="#largegroup" type="button" role="tab"
                                            aria-controls="largegroup" aria-selected="false">
                                            <i class="bi bi-people-fill me-2"></i>Large Group (10+)
                                        </button>
                                    </li>
                                </ul>

                                <div class="tab-content p-4 border border-top-0 rounded-bottom"
                                    id="visitorTypeTabContent">
                                    <!-- Individual / Small Group Tab -->
                                    <div class="tab-pane fade show active" id="individual" role="tabpanel"
                                        aria-labelledby="individual-tab">
                                        <div class="alert alert-warning">
                                            <h5><i class="bi bi-credit-card me-2"></i>Application & Service Charges</h5>
                                            <p class="mt-3 mb-3">
                                                The one-time application fee is <strong>Rs. 200 per
                                                    person</strong> and must be paid during registration.
                                            </p>

                                            <h6><i class="bi bi-check-circle me-2"></i>Includes:</h6>
                                            <ul class="mb-3">
                                                <li>Supervised interaction with children</li>
                                                <li>Up to 5 photos (group and individual)</li>
                                                <li>One-day engagement/visit</li>
                                            </ul>

                                            <h6><i class="bi bi-calendar-plus me-2"></i>Extended Engagement:</h6>
                                            <p class="mb-0 ps-3">
                                                <strong>For repeat visits or multi-day engagements:</strong>
                                                Rs. 150 per person per additional day (from the second day onwards)
                                            </p>

                                            <hr class="my-3">

                                            <h6><i class="bi bi-plus-circle me-2"></i>Additional Services:</h6>
                                            <ul class="mb-3">
                                                <li><strong>Certificate/Acknowledgment Letter:</strong> Rs. 250 per
                                                    certificate</li>
                                                <li><strong>Interview with Centre In-Charge or Teachers:</strong> Rs.
                                                    250 per session (30 minutes)</li>
                                                <li><strong>Videography (personal camera or mobile, with prior
                                                        approval):</strong> Rs. 100 per device</li>
                                            </ul>
                                            <hr class="my-3">

                                            <div class="text-center">
                                                <a href="https://eazypay.icicibank.com/eazypayLink?P1=ldvYO7WCMgfIXlGHmwXsxg=="
                                                    class="btn btn-warning btn-lg" target="_blank">
                                                    <i class="bi bi-credit-card me-2"></i> Proceed to Payment
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Large Group Tab -->
                                    <div class="tab-pane fade" id="largegroup" role="tabpanel"
                                        aria-labelledby="largegroup-tab">
                                        <div class="alert alert-primary">
                                            <h5><i class="bi bi-people-fill me-2"></i>Large Group Visits (10+ Members)
                                            </h5>
                                            <p class="mb-3">
                                                For groups of 10+ members, please contact our visiting officer for
                                                customized arrangements.
                                            </p>

                                            <div class="text-center mb-3">
                                                <a href="https://wa.me/917980168159?text=Hello,%20I'm%20interested%20in%20a%20group%20visit.%20%0A%0AName:%20%0ACollege/University:%20%0ADesignation:%20%0AGroup%20Size:%20%0APurpose:%20"
                                                    class="btn btn-success btn-lg" target="_blank">
                                                    <i class="bi bi-whatsapp me-2"></i> Contact on WhatsApp
                                                </a>
                                            </div>

                                            <div class="text-center mt-3">
                                                <div class="card bg-light">
                                                    <div class="card-body">
                                                        <i class="bi bi-telephone text-primary fs-4"></i>
                                                        <h6 class="mb-1">Direct Contact</h6>
                                                        <p class="mb-0 fs-5 text-dark">+91 79801 68159</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="message" class="form-label">Message
                                (Optional)</label>
                            <textarea class="form-control" id="message" name="message" rows="4"></textarea>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="declaration" name="declaration"
                                required>
                            <label class="form-check-label" for="declaration">I agree to the terms and
                                conditions</label>
                        </div>

                        <button type="submit" class="btn btn-primary" id="visitButton" disabled>Submit</button>
                    </div>
                </form>

                <form name="get_details_form" id="get_details_form" action="#" method="POST">
                    <input type="hidden" name="form-type" value="get_details_visit">
                    <input type="hidden" name="contactnumber_verify_input">
                </form>
            </div>
        </section>
        <!-- Bootstrap Modal -->
        <div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-body">
                        <div class="text-center">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p id="loadingMessage">Submission in progress.
                                Please do not close or reload this page.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <!-- ======= Footer ======= -->
    <div id="footer"></div>
    <!-- End Footer -->
    <a href="#" class="scroll-top d-flex align-items-center justify-content-center"><i
            class="bi bi-arrow-up-short"></i></a>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Load jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="/js/main.js?v=7.0.0"></script>
    <script src="/js/image-compressor-100kb.js"></script>
    <!-- JavaScript to handle form logic -->
    <script>
        var contactNumberInput = document.getElementById("contactnumber_verify");
        var contactNumberVerifyInput = document.getElementsByName("contactnumber_verify_input")[0];
        var visitorNameInput = document.getElementById("visitorName");
        var visitorEmailInput = document.getElementById("visitorEmail");
        var telInput = document.getElementById("tel");
        var verificationResultDiv = document.getElementById("verificationResult");
        var visitButton = document.getElementById('visitButton');
        var newvisitorInfo = document.getElementById('newvisitorInfo');

        // Add this flag here
        let isContactVerified = false;

        contactNumberInput.addEventListener("input", function (event) {
            contactNumberVerifyInput.value = this.value;
        });

        // Dynamically set the base script URL based on the environment
        const scriptURL = window.location.hostname === 'localhost'
            ? 'http://localhost:8082/rssi-member/payment-api.php'
            : 'https://login.rssi.in/rssi-member/payment-api.php';

        // Function to update the 'required' attribute of fields based on visibility
        function updateRequiredFields() {
            const requiredFields = document.querySelectorAll('[required]');

            requiredFields.forEach(field => {
                const label = document.querySelector(`label[for="${field.id}"]`);
                if (label) {
                    const hasAsterisk = label.querySelector('.required-asterisk');

                    if (field.required && !hasAsterisk) {
                        const asterisk = document.createElement('span');
                        asterisk.className = 'required-asterisk';
                        asterisk.textContent = ' *';
                        label.appendChild(asterisk);
                    } else if ((!field.offsetParent || !field.required) && hasAsterisk) {
                        label.removeChild(hasAsterisk);
                        field.required = false;
                    }
                }
            });
        }

        // Call the function initially to set up the required fields
        updateRequiredFields();

        // Function to handle the "verifybutton" click event
        function handleVerifyButtonClick(event) {
            event.preventDefault(); // prevent default form submission

            const verifyButton = document.getElementById("verifybutton");
            // Save original button text
            const originalText = verifyButton.innerHTML;

            // Disable button and show spinner
            verifyButton.disabled = true;
            verifyButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Finding...';

            fetch(scriptURL, {
                method: 'POST',
                body: new FormData(document.forms['get_details_form'])
            })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        visitorNameInput.value = data.data.fullname;
                        visitorEmailInput.value = data.data.email;
                        telInput.value = data.data.tel;
                        verificationResultDiv.style.display = "block"; // Show the result div
                        visitinfo.style.display = 'block';
                        visitButton.disabled = false;
                        alert("User data fetched successfully!");

                        // Disable the contact number input and button after successful verification
                        contactNumberInput.disabled = true;
                        verifyButton.disabled = true;

                    } else if (data.status === 'no_records') {
                        verificationResultDiv.style.display = "none"; // Hide the result div
                        visitinfo.style.display = 'none';
                        visitButton.disabled = true;
                        visitorNameInput.value = "";
                        visitorEmailInput.value = "";
                        telInput.value = "";
                        alert("No records found in the database. Register as a new user.");

                        // Reset button to original state
                        verifyButton.disabled = false;
                        verifyButton.innerHTML = originalText;
                    } else {
                        console.log('Error:', data.message);
                        alert("Error retrieving user data. Please try again later or contact support.");

                        // Reset button to original state
                        verifyButton.disabled = false;
                        verifyButton.innerHTML = originalText;
                    }

                    // Reset button to original state
                    verifyButton.innerHTML = originalText;

                    // Call the updateRequiredFields() function after handling the verify button click
                    updateRequiredFields();
                })
                .catch(error => {
                    console.log('Error:', error);
                    alert("Error fetching user data. Please try again later or contact support.");

                    // Reset button to original state on error
                    verifyButton.disabled = false;
                    verifyButton.innerHTML = originalText;

                    // Call the updateRequiredFields() function after handling the verify button click
                    updateRequiredFields();
                });
        }

        // Add event listener to the "verifybutton" element
        document.getElementById("verifybutton").addEventListener("click", handleVerifyButtonClick);


        // JavaScript function to toggle visitor sections based on visitor type
        function togglevisitorSections() {
            const visitorType = document.getElementById('visitorType').value;
            const existingvisitorInfo = document.getElementById('existingvisitorInfo');
            const newvisitorInfo = document.getElementById('newvisitorInfo');
            const verificationResult = document.getElementById('verificationResult');
            const visitinfoSection = document.getElementById('visitinfo');
            const contactNumberInput = document.getElementById('contactnumber_verify');
            const verifyButton = document.getElementById('verifybutton');

            if (visitorType === 'existing') {
                existingvisitorInfo.style.display = 'block';
                newvisitorInfo.style.display = 'none';
                verificationResult.style.display = 'none';
                visitinfoSection.style.display = 'none';
                visitButton.disabled = true;

                // Reset contact number field and button if they were disabled from previous verification
                if (contactNumberInput) {
                    contactNumberInput.disabled = false;
                    contactNumberInput.removeAttribute('readonly');
                }
                if (verifyButton) {
                    verifyButton.disabled = false;
                    verifyButton.innerHTML = 'Find your details';
                    verifyButton.classList.remove('btn-success');
                    verifyButton.classList.add('btn-primary');
                }
            } else if (visitorType === 'new') {
                existingvisitorInfo.style.display = 'none';
                newvisitorInfo.style.display = 'block';
                verificationResult.style.display = 'none';
                visitinfoSection.style.display = 'block';
                visitButton.disabled = false;
            } else {
                existingvisitorInfo.style.display = 'none';
                newvisitorInfo.style.display = 'none';
                verificationResult.style.display = 'none';
                visitinfoSection.style.display = 'none';
                visitButton.disabled = true;
            }
        }
        // Function to handle the visitor type change event
        function handlevisitorTypeChange() {
            const visitorType = document.getElementById("visitorType").value;
            const fullNameInput = document.getElementById("fullName");
            const emailInput = document.getElementById("email");
            const contactNumberNewInput = document.getElementById("contactNumberNew");
            const governmentIdInput = document.getElementById("governmentId");
            const idTypeInput = document.getElementById("idType");
            const idNumberInput = document.getElementById("idNumber");
            const photoInput = document.getElementById("photo");

            // Set required attribute based on the visitor type
            if (visitorType === "existing") {
                fullNameInput.removeAttribute("required");
                emailInput.removeAttribute("required");
                contactNumberNewInput.removeAttribute("required");
                governmentIdInput.removeAttribute("required");
                idTypeInput.removeAttribute("required");
                idNumberInput.removeAttribute("required");
                photoInput.removeAttribute("required");
            } else if (visitorType === "new") {
                fullNameInput.setAttribute("required", true);
                emailInput.setAttribute("required", true);
                contactNumberNewInput.setAttribute("required", true);
                governmentIdInput.setAttribute("required", true);
                idTypeInput.removeAttribute("required", true);
                idNumberInput.removeAttribute("required", true);
                photoInput.setAttribute("required", true);
            }
        }

        // Add event listener to the "visitorType" element
        document.getElementById("visitorType").addEventListener("change", handlevisitorTypeChange);
    </script>
    <script>
        // Function to show/hide and mark/unmark fields as required based on the selected value of the radio button
        function toggleFields() {
            var visitPurpose = document.querySelector('input[name="visitpurpose"]:checked').value;
            var additionalFields = document.getElementById('additionalFields');

            if (visitPurpose === 'College/University project as a part of community service') {
                additionalFields.style.display = 'block';

                // Mark fields as required
                document.getElementById('institutename').setAttribute('required', '');
                document.getElementById('enrollmentnumber').setAttribute('required', '');
                document.getElementById('instituteid').setAttribute('required', '');
                document.getElementById('mentoremail').setAttribute('required', '');
                document.getElementById('paymentdoc').setAttribute('required', '');
            } else {
                additionalFields.style.display = 'none';

                // Remove required attribute
                document.getElementById('institutename').removeAttribute('required');
                document.getElementById('enrollmentnumber').removeAttribute('required');
                document.getElementById('instituteid').removeAttribute('required');
                document.getElementById('mentoremail').removeAttribute('required');
                document.getElementById('paymentdoc').removeAttribute('required');
            }
            // Call the updateRequiredFields() function after handling the verify button click
            updateRequiredFields();
        }

        // Add event listener to radio buttons
        var radioButtons = document.querySelectorAll('input[name="visitpurpose"]');
        radioButtons.forEach(function (radioButton) {
            radioButton.addEventListener('change', toggleFields);
        });
    </script>
    <script>
        const visitorForm = document.getElementById("visitorInfoForm");

        document.getElementById("visitButton").addEventListener("click", async function (event) {
            event.preventDefault(); // Prevent default form submission

            if (!visitorForm.checkValidity()) {
                visitorForm.reportValidity(); // Show the default validation messages
                return;
            }

            // Disable the donate button immediately upon form submission
            this.disabled = true;
            // Show the Bootstrap modal
            const myModal = new bootstrap.Modal(document.getElementById("myModal"), {
                backdrop: 'static',
                keyboard: false
            });
            myModal.show();

            try {
                const response = await fetch(scriptURL, {
                    method: 'POST',
                    body: new FormData(visitorForm)
                });
                const result = await response.json();

                console.log("API Response:", result); // For testing purposes, log the entire response

                if (!result.error) {
                    alert(`Submitted successfully! visitor reference ID: ${result.visitorId}`);
                    visitorForm.reset(); // Reset the form after successful submission
                    location.reload(); // Reload the page after successful submission
                } else {
                    if (result.errorMessage === "") {
                        alert("Error occurred during form submission. Please try again later.");
                    } else if (result.errorMessage === "already_registered") {
                        alert("Oops! You are already registered in our database. Please proceed as an existing visitor.");
                    } else {
                        alert("Unknown error occurred during form submission.");
                    }
                }
            } catch (error) {
                console.error(error);
                alert("Error occurred during form submission. Please try again later.");
            } finally {
                // Re-enable the donate button after the form submission process is finished
                this.disabled = false;
                myModal.hide();
            }
        });
    </script>
    <script>
        $(document).ready(function () {
            $('input[type="radio"]').change(function () {
                if ($(this).val() == 'Other') {
                    $('#other_reason').show().attr('required', 'required');
                } else {
                    $('#other_reason').hide().removeAttr('required').val('');
                }
            });
        });
    </script>
    <!-- Scripts for conditional display + required logic -->
    <script>
        function toggleInterviewDuration() {
            const checkbox = document.getElementById('service_interview');
            const container = document.getElementById('interview_duration_container');
            const input = document.getElementById('interview_duration');

            container.style.display = checkbox.checked ? 'block' : 'none';
            input.required = checkbox.checked;       // toggle required
            if (!checkbox.checked) input.value = 30; // reset default if unchecked

            updateRequiredFields();                  // update the asterisk dynamically
        }

        function toggleCameraCount() {
            const checkbox = document.getElementById('service_video');
            const container = document.getElementById('camera_count_container');
            const input = document.getElementById('camera_count');

            container.style.display = checkbox.checked ? 'block' : 'none';
            input.required = checkbox.checked;      // toggle required
            if (!checkbox.checked) input.value = 1; // reset default if unchecked

            updateRequiredFields();                 // update the asterisk dynamically
        }
    </script>
    <script src="https://cdn.jsdelivr.net/gh/manucaralmo/GlowCookies@3.0.1/src/glowCookies.min.js"></script>
    <script>
        glowCookies.start('en', {
            analytics: 'G-S25QWTFJ2S',
            policyLink: 'disclaimer'
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const alertEl = document.getElementById('visitorAlert');
            const timerEl = document.getElementById('alertTimer');
            const pauseBtn = document.getElementById('pauseTimerBtn');
            const pauseIcon = document.getElementById('pauseIcon');
            const closeBtn = document.getElementById('closeAlertBtn');
            const miniNotification = document.getElementById('miniNotification');
            const expandNotificationBtn = document.getElementById('expandNotificationBtn');
            const notificationBadge = document.getElementById('notificationBadge');

            let seconds = 10; // auto-dismiss time
            let interval;
            let isPaused = false;
            let isCollapsed = false;

            function startTimer() {
                interval = setInterval(() => {
                    if (!isPaused) {
                        seconds--;
                        if (timerEl) timerEl.textContent = seconds;

                        if (seconds <= 0 && !isCollapsed) {
                            // Collapse to mini notification instead of closing
                            collapseToNotification();
                        }
                    }
                }, 1000);
            }

            // Start the timer initially
            startTimer();

            function collapseToNotification() {
                clearInterval(interval);
                isCollapsed = true;

                // Hide the main alert
                alertEl.style.display = 'none';

                // Show the mini notification
                miniNotification.style.display = 'block';

                // Add animation effect
                miniNotification.classList.add('animate__animated', 'animate__fadeIn');

                // Remove animation classes after animation completes
                setTimeout(() => {
                    miniNotification.classList.remove('animate__animated', 'animate__fadeIn');
                }, 1000);
            }

            function expandNotification() {
                // Hide mini notification
                miniNotification.style.display = 'none';

                // Show the main alert again
                alertEl.style.display = 'block';
                alertEl.classList.add('animate__animated', 'animate__fadeIn');

                // Remove collapsed state
                isCollapsed = false;

                // Reset timer
                seconds = 10;
                if (timerEl) timerEl.textContent = seconds;

                // Restart timer
                clearInterval(interval);
                startTimer();

                // Remove animation classes after animation completes
                setTimeout(() => {
                    alertEl.classList.remove('animate__animated', 'animate__fadeIn');
                }, 1000);
            }

            // Pause/Resume functionality
            if (pauseBtn) {
                pauseBtn.addEventListener('click', function () {
                    isPaused = !isPaused;

                    if (isPaused) {
                        // Change to play icon and update title
                        pauseIcon.className = 'bi bi-play';
                        pauseBtn.setAttribute('title', 'Resume timer');
                        pauseBtn.setAttribute('data-paused', 'true');
                        pauseBtn.classList.remove('btn-outline-light');
                        pauseBtn.classList.add('btn-warning');
                        timerEl.textContent = 'Paused';
                    } else {
                        // Change back to pause icon
                        pauseIcon.className = 'bi bi-pause';
                        pauseBtn.setAttribute('title', 'Pause timer');
                        pauseBtn.setAttribute('data-paused', 'false');
                        pauseBtn.classList.remove('btn-warning');
                        pauseBtn.classList.add('btn-outline-light');
                        timerEl.textContent = seconds;
                    }
                });
            }

            // Expand notification when clicked
            if (expandNotificationBtn) {
                expandNotificationBtn.addEventListener('click', function () {
                    expandNotification();
                });
            }

            // Close alert manually
            if (closeBtn) {
                closeBtn.addEventListener('click', function () {
                    clearInterval(interval);
                    isCollapsed = true;
                    alertEl.style.display = 'none';
                    miniNotification.style.display = 'block';
                });
            }

            // Stop timer if alert is closed by Bootstrap (if user uses dismiss)
            alertEl.addEventListener('closed.bs.alert', () => {
                clearInterval(interval);
                isCollapsed = true;
                miniNotification.style.display = 'block';
            });

            // Optional: Add keyboard shortcuts
            document.addEventListener('keydown', function (e) {
                // Spacebar to toggle pause
                if (e.code === 'Space' && pauseBtn && !isCollapsed) {
                    e.preventDefault();
                    pauseBtn.click();
                }
                // Escape to minimize
                if (e.code === 'Escape' && !isCollapsed) {
                    e.preventDefault();
                    collapseToNotification();
                }
                // Enter to expand when notification is visible
                if (e.code === 'Enter' && isCollapsed && document.activeElement === expandNotificationBtn) {
                    expandNotification();
                }
            });

            // Optional: Auto-hide notification after 1 minute
            setTimeout(() => {
                if (isCollapsed && miniNotification.style.display === 'block') {
                    miniNotification.style.opacity = '0.5';
                    notificationBadge.textContent = 'i';

                    // Fade out completely after another 30 seconds
                    setTimeout(() => {
                        miniNotification.style.display = 'none';
                    }, 30000);
                }
            }, 60000);

            // Optional: Tooltip for buttons
            if (pauseBtn) {
                new bootstrap.Tooltip(pauseBtn);
            }
            if (expandNotificationBtn) {
                new bootstrap.Tooltip(expandNotificationBtn);
            }

            // Add click outside to close notification (optional)
            document.addEventListener('click', function (e) {
                if (isCollapsed &&
                    !miniNotification.contains(e.target) &&
                    !alertEl.contains(e.target)) {
                    // Optional: Hide notification if clicked outside
                    // miniNotification.style.display = 'none';
                }
            });
        });
    </script>

</body>

</html>