<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Library Registration</title>
    <meta name="description"
        content="Register for the Student Library at Baangee Traders. Fill out the form with your personal details and upload necessary documents to complete your registration.">
    <meta name="keywords"
        content="Student Library Registration, Baangee Traders, Library Form, Student ID, Aadhar, PAN, Document Upload">
    <meta name="author" content="Baangee Traders">
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
    <!-- Bootstrap 5.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <!-- Main CSS -->
    <link rel="stylesheet" href="css/main.css?v=1.5">
    <style>
        .registration-container {
            max-width: 900px;
            margin: 40px auto;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .registration-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 30px;
            text-align: center;
        }

        .registration-header h1 {
            font-weight: 700;
            font-size: 2.2rem;
        }

        .registration-header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .form-section {
            padding: 30px;
            border-bottom: 1px solid #eee;
        }

        .section-title {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 25px;
            padding-bottom: 10px;
            /* border-bottom: 2px solid var(--accent-color); */
        }

        .form-label {
            font-weight: 600;
            color: #444;
        }

        .required::after {
            content: " *";
            color: #e74c3c;
        }

        .file-upload {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background-color: #f9f9f9;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload:hover {
            border-color: var(--secondary-color);
            background-color: #f0f8ff;
        }

        .file-upload i {
            font-size: 2rem;
            color: var(--secondary-color);
            margin-bottom: 10px;
        }

        .form-check-label {
            font-weight: 500;
        }

        .address-checkbox {
            margin-top: 10px;
            margin-bottom: 20px;
        }

        .btn-submit {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 12px 30px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            transition: all 0.3s;
            width: unset;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-reset {
            background-color: #f8f9fa;
            color: #333;
            padding: 12px 30px;
            font-weight: 600;
            border: 1px solid #ddd;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .btn-reset:hover {
            background-color: #e9ecef;
        }

        .form-footer {
            background-color: #f8f9fa;
            padding: 20px 30px;
            text-align: center;
            border-top: 1px solid #eee;
        }

        .form-footer p {
            margin: 0;
            color: #666;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .registration-container {
                margin: 20px 10px;
            }

            .form-section {
                padding: 20px;
            }

            .registration-header {
                padding: 20px;
            }

            .registration-header h1 {
                font-size: 1.8rem;
            }
        }

        /* Unified preview container style for both images and PDFs */
        .upload-preview,
        .pdf-preview {
            max-height: 180px;
            overflow-y: auto;
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            margin-top: 10px;
            display: none;
            /* Hidden by default */
        }

        /* For image previews specifically */
        .upload-preview {
            display: block;
            /* But will be overridden by display: none initially */
            text-align: center;
        }

        .upload-preview img {
            max-width: 100%;
            max-height: 140px;
            height: auto;
            display: block;
            margin: 0 auto;
            border-radius: 4px;
            object-fit: contain;
        }

        /* For PDF previews */
        .pdf-preview canvas {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* File info section for both */
        .file-info {
            font-size: 0.8rem;
            color: #666;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #dee2e6;
        }

        .file-info p {
            margin-bottom: 4px;
        }

        /* Custom scrollbar for preview boxes */
        .upload-preview::-webkit-scrollbar,
        .pdf-preview::-webkit-scrollbar {
            width: 6px;
        }

        .upload-preview::-webkit-scrollbar-track,
        .pdf-preview::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .upload-preview::-webkit-scrollbar-thumb,
        .pdf-preview::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }

        .upload-preview::-webkit-scrollbar-thumb:hover,
        .pdf-preview::-webkit-scrollbar-thumb:hover {
            background: #aaa;
        }
    </style>
</head>

<body>
    <!-- Header will be loaded here -->
    <div id="header-placeholder"></div>
    <!-- Main Content -->
    <div class="registration-container">
        <div class="registration-header">
            <h1><i class="bi bi-book-half me-2"></i>Student Library Registration</h1>
            <p>Please fill out all the required fields to complete your registration</p>
        </div>

        <form id="libraryRegistrationForm">
            <!-- Personal Information Section -->
            <div class="form-section">
                <h3 class="section-title"><i class="bi bi-person-circle me-2"></i>Personal Information</h3>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="studentName" class="form-label required">Student Name</label>
                        <input type="text" class="form-control" id="studentName" required
                            placeholder="Enter your full name">
                    </div>
                    <div class="col-md-6">
                        <label for="studentEmail" class="form-label required">Student Email</label>
                        <input type="email" class="form-control" id="studentEmail" required
                            placeholder="example@university.edu">
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="phoneNumber" class="form-label required">Phone Number</label>
                        <input type="tel" class="form-control" id="phoneNumber" required
                            placeholder="Enter 10-digit mobile number">
                    </div>
                    <div class="col-md-6">
                        <label for="studentId" class="form-label required">Student ID</label>
                        <input type="text" class="form-control" id="studentId" required
                            placeholder="University issued ID">
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="aadharNumber" class="form-label required">Aadhar Number</label>
                        <input type="text" class="form-control" id="aadharNumber" required
                            placeholder="12-digit Aadhar number">
                    </div>
                    <div class="col-md-6">
                        <label for="panNumber" class="form-label">PAN Number</label>
                        <input type="text" class="form-control" id="panNumber" placeholder="10-character PAN number">
                    </div>
                </div>
            </div>

            <!-- Document Upload Section -->
            <div class="form-section">
                <h3 class="section-title"><i class="bi bi-cloud-arrow-up me-2"></i>Document Upload</h3>
                <p class="text-muted mb-4">Please upload clear scanned copies of the following documents (Max file size:
                    2MB each)</p>

                <div class="row mb-4">
                    <div class="col-md-4 mb-3">
                        <label class="form-label required">Aadhar Card</label>
                        <div class="file-upload" id="aadharUpload">
                            <i class="bi bi-file-earmark-text"></i>
                            <p class="mb-1">Click to upload Aadhar</p>
                            <small class="text-muted">PDF, JPG, or PNG</small>
                            <input type="file" class="d-none" id="aadharFile" accept=".pdf,.jpg,.jpeg,.png">
                        </div>
                        <img id="aadharPreview" class="upload-preview img-thumbnail" alt="Aadhar Preview">
                        <div id="aadharPdfPreview" class="pdf-preview text-center">
                            <i class="bi bi-filetype-pdf pdf-icon"></i>
                            <p class="mb-0 mt-2" id="aadharPdfName">document.pdf</p>
                        </div>
                    </div>

                    <div class="col-md-4 mb-3">
                        <label class="form-label">PAN Card</label>
                        <div class="file-upload" id="panUpload">
                            <i class="bi bi-credit-card"></i>
                            <p class="mb-1">Click to upload PAN</p>
                            <small class="text-muted">PDF, JPG, or PNG</small>
                            <input type="file" class="d-none" id="panFile" accept=".pdf,.jpg,.jpeg,.png">
                        </div>
                        <img id="panPreview" class="upload-preview img-thumbnail" alt="PAN Preview">
                        <div id="panPdfPreview" class="pdf-preview text-center">
                            <i class="bi bi-filetype-pdf pdf-icon"></i>
                            <p class="mb-0 mt-2" id="panPdfName">document.pdf</p>
                        </div>
                    </div>

                    <div class="col-md-4 mb-3">
                        <label class="form-label required">Signature</label>
                        <div class="file-upload" id="signatureUpload">
                            <i class="bi bi-pen"></i>
                            <p class="mb-1">Click to upload Signature</p>
                            <small class="text-muted">PDF, JPG, or PNG</small>
                            <input type="file" class="d-none" id="signatureFile" accept=".pdf,.jpg,.jpeg,.png">
                        </div>
                        <img id="signaturePreview" class="upload-preview img-thumbnail" alt="Signature Preview">
                        <div id="signaturePdfPreview" class="pdf-preview text-center">
                            <i class="bi bi-filetype-pdf pdf-icon"></i>
                            <p class="mb-0 mt-2" id="signaturePdfName">document.pdf</p>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 offset-md-3">
                        <label class="form-label required">Student Photo</label>
                        <div class="file-upload" id="photoUpload">
                            <i class="bi bi-camera"></i>
                            <p class="mb-1">Click to upload Photo</p>
                            <small class="text-muted">JPG or PNG (Passport size)</small>
                            <input type="file" class="d-none" id="photoFile" accept=".jpg,.jpeg,.png">
                        </div>
                        <img id="photoPreview" class="upload-preview img-thumbnail" alt="Photo Preview">
                        <!-- Note: Photo doesn't need PDF preview since it only accepts image files -->
                    </div>
                </div>
            </div>

            <!-- Address Section -->
            <div class="form-section">
                <h3 class="section-title"><i class="bi bi-geo-alt me-2"></i>Address Details</h3>

                <div class="mb-4">
                    <h5 class="mb-3">Permanent Address</h5>
                    <div class="row mb-3">
                        <div class="col-12">
                            <label for="permanentAddress" class="form-label required">Full Address</label>
                            <textarea class="form-control" id="permanentAddress" rows="3" required
                                placeholder="House no., Street, Area, City, State, Pincode"></textarea>
                        </div>
                    </div>
                </div>

                <div class="address-checkbox form-check mb-4">
                    <input class="form-check-input" type="checkbox" id="sameAsPermanent">
                    <label class="form-check-label" for="sameAsPermanent">
                        Correspondence address is same as permanent address
                    </label>
                </div>

                <div id="correspondenceAddressSection">
                    <h5 class="mb-3">Correspondence Address</h5>
                    <div class="row">
                        <div class="col-12">
                            <label for="correspondenceAddress" class="form-label required">Full Address</label>
                            <textarea class="form-control" id="correspondenceAddress" rows="3" required
                                placeholder="House no., Street, Area, City, State, Pincode"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Additional Notes Section -->
            <div class="form-section">
                <h3 class="section-title"><i class="bi bi-chat-text me-2"></i>Additional Notes</h3>
                <div class="mb-3">
                    <label for="additionalNotes" class="form-label">Any additional information you'd like to share
                        (Optional)</label>
                    <textarea class="form-control" id="additionalNotes" rows="4"
                        placeholder="Special requirements, additional contact information, etc."></textarea>
                </div>
            </div>

            <!-- Form Buttons -->
            <div class="form-section">
                <div class="d-flex justify-content-between">
                    <button type="reset" class="btn btn-reset">
                        <i class="bi bi-arrow-clockwise me-2"></i>Reset Form
                    </button>
                    <button type="submit" class="btn btn-submit">
                        <i class="bi bi-send-check me-2"></i>Submit Registration
                    </button>
                </div>
            </div>
        </form>

        <div class="form-footer">
            <p><i class="bi bi-info-circle me-1"></i> All fields marked with * are required. Your data will be securely
                stored and used only for library registration purposes.</p>
        </div>
    </div>

    <!-- Footer will be loaded here -->
    <div id="footer-placeholder"></div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <!-- Main JS -->
    <script src="js/main.js?v=1.5"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // File upload functionality
            const fileUploads = [
                {
                    container: 'aadharUpload',
                    input: 'aadharFile',
                    imagePreview: 'aadharPreview',
                    pdfPreview: 'aadharPdfPreview',
                    pdfName: 'aadharPdfName'
                },
                {
                    container: 'panUpload',
                    input: 'panFile',
                    imagePreview: 'panPreview',
                    pdfPreview: 'panPdfPreview',
                    pdfName: 'panPdfName'
                },
                {
                    container: 'signatureUpload',
                    input: 'signatureFile',
                    imagePreview: 'signaturePreview',
                    pdfPreview: 'signaturePdfPreview',
                    pdfName: 'signaturePdfName'
                },
                {
                    container: 'photoUpload',
                    input: 'photoFile',
                    imagePreview: 'photoPreview',
                    // Photo doesn't accept PDF, so no PDF preview needed
                }
            ];

            fileUploads.forEach(upload => {
                const container = document.getElementById(upload.container);
                const input = document.getElementById(upload.input);
                const imagePreview = document.getElementById(upload.imagePreview);

                container.addEventListener('click', () => input.click());

                input.addEventListener('change', function () {
                    if (this.files && this.files[0]) {
                        const file = this.files[0];
                        const fileName = file.name;
                        const fileType = file.type;

                        // Reset all previews first
                        if (upload.imagePreview) {
                            imagePreview.style.display = 'none';
                            imagePreview.src = '';
                        }

                        if (upload.pdfPreview) {
                            const pdfPreview = document.getElementById(upload.pdfPreview);
                            pdfPreview.style.display = 'none';
                        }

                        // Update the upload area text
                        container.querySelector('p').textContent = 'File selected: ' + fileName;

                        // Handle image files
                        if (fileType === 'image/jpeg' || fileType === 'image/jpg' || fileType === 'image/png') {
                            const reader = new FileReader();

                            reader.onload = function (e) {
                                if (upload.imagePreview) {
                                    imagePreview.src = e.target.result;
                                    imagePreview.style.display = 'block';
                                }
                            };

                            reader.readAsDataURL(file);
                        }
                        // Handle PDF files
                        else if (fileType === 'application/pdf') {
                            if (upload.pdfPreview) {
                                // Show PDF thumbnail instead of just icon
                                generatePdfThumbnail(file, upload.pdfPreview, upload.pdfName, fileName);
                            }
                        }
                    } else {
                        // No file selected - hide all previews
                        if (upload.imagePreview) {
                            imagePreview.style.display = 'none';
                            imagePreview.src = '';
                        }

                        if (upload.pdfPreview) {
                            const pdfPreview = document.getElementById(upload.pdfPreview);
                            pdfPreview.style.display = 'none';
                        }

                        // Reset upload text
                        if (container.id === 'photoUpload') {
                            container.querySelector('p').textContent = 'Click to upload Photo';
                        } else if (container.id === 'aadharUpload') {
                            container.querySelector('p').textContent = 'Click to upload Aadhar';
                        } else if (container.id === 'panUpload') {
                            container.querySelector('p').textContent = 'Click to upload PAN';
                        } else if (container.id === 'signatureUpload') {
                            container.querySelector('p').textContent = 'Click to upload Signature';
                        }
                    }
                });
            });

            // Same as permanent address checkbox functionality
            const sameAsPermanentCheckbox = document.getElementById('sameAsPermanent');
            const permanentAddress = document.getElementById('permanentAddress');
            const correspondenceAddress = document.getElementById('correspondenceAddress');
            const correspondenceAddressSection = document.getElementById('correspondenceAddressSection');

            sameAsPermanentCheckbox.addEventListener('change', function () {
                if (this.checked) {
                    correspondenceAddress.value = permanentAddress.value;
                    correspondenceAddressSection.style.opacity = '0.6';
                    correspondenceAddress.disabled = true;
                } else {
                    correspondenceAddress.value = '';
                    correspondenceAddressSection.style.opacity = '1';
                    correspondenceAddress.disabled = false;
                }
            });

            // Update correspondence address when permanent address changes (if checkbox is checked)
            permanentAddress.addEventListener('input', function () {
                if (sameAsPermanentCheckbox.checked) {
                    correspondenceAddress.value = this.value;
                }
            });

            // Form submission
            const form = document.getElementById('libraryRegistrationForm');
            form.addEventListener('submit', function (e) {
                e.preventDefault();

                // Basic validation
                const requiredFields = form.querySelectorAll('[required]');
                let isValid = true;

                requiredFields.forEach(field => {
                    if (!field.value.trim()) {
                        field.classList.add('is-invalid');
                        isValid = false;
                    } else {
                        field.classList.remove('is-invalid');
                    }
                });

                // Check if Aadhar, Signature, and Photo files are uploaded
                const aadharFile = document.getElementById('aadharFile');
                const signatureFile = document.getElementById('signatureFile');
                const photoFile = document.getElementById('photoFile');

                if (!aadharFile.files.length) {
                    alert('Please upload your Aadhar card');
                    document.getElementById('aadharUpload').style.borderColor = '#e74c3c';
                    isValid = false;
                } else {
                    document.getElementById('aadharUpload').style.borderColor = '';
                }

                if (!signatureFile.files.length) {
                    alert('Please upload your signature');
                    document.getElementById('signatureUpload').style.borderColor = '#e74c3c';
                    isValid = false;
                } else {
                    document.getElementById('signatureUpload').style.borderColor = '';
                }

                if (!photoFile.files.length) {
                    alert('Please upload your photo');
                    document.getElementById('photoUpload').style.borderColor = '#e74c3c';
                    isValid = false;
                } else {
                    document.getElementById('photoUpload').style.borderColor = '';
                }

                if (isValid) {
                    // In a real application, you would submit to a server here
                    // For demo purposes, we'll just show an alert
                    alert('Registration submitted successfully! Your library card will be issued within 3-5 working days.');
                    form.reset();

                    // Reset preview images and PDF previews
                    document.querySelectorAll('.upload-preview').forEach(preview => {
                        preview.style.display = 'none';
                        preview.src = '';
                    });

                    document.querySelectorAll('.pdf-preview').forEach(preview => {
                        preview.style.display = 'none';
                    });

                    // Reset upload text
                    document.querySelectorAll('.file-upload p').forEach(p => {
                        if (p.textContent.includes('File selected:')) {
                            if (p.parentElement.id === 'aadharUpload') {
                                p.textContent = 'Click to upload Aadhar';
                            } else if (p.parentElement.id === 'panUpload') {
                                p.textContent = 'Click to upload PAN';
                            } else if (p.parentElement.id === 'signatureUpload') {
                                p.textContent = 'Click to upload Signature';
                            } else if (p.parentElement.id === 'photoUpload') {
                                p.textContent = 'Click to upload Photo';
                            }
                        }
                    });

                    // Reset address checkbox
                    sameAsPermanentCheckbox.checked = false;
                    correspondenceAddressSection.style.opacity = '1';
                    correspondenceAddress.disabled = false;

                    // Reset border colors
                    document.querySelectorAll('.file-upload').forEach(upload => {
                        upload.style.borderColor = '';
                    });
                } else {
                    alert('Please fill all required fields before submitting.');
                }
            });

            // Real-time validation for specific fields
            document.getElementById('phoneNumber').addEventListener('input', function () {
                const phoneRegex = /^[0-9]{10}$/;
                if (!phoneRegex.test(this.value)) {
                    this.classList.add('is-invalid');
                } else {
                    this.classList.remove('is-invalid');
                }
            });

            document.getElementById('aadharNumber').addEventListener('input', function () {
                const aadharRegex = /^[0-9]{12}$/;
                if (!aadharRegex.test(this.value)) {
                    this.classList.add('is-invalid');
                } else {
                    this.classList.remove('is-invalid');
                }
            });

            document.getElementById('panNumber').addEventListener('input', function () {
                if (this.value.trim() !== '') {
                    const panRegex = /^[A-Z]{5}[0-9]{4}[A-Z]{1}$/;
                    if (!panRegex.test(this.value.toUpperCase())) {
                        this.classList.add('is-invalid');
                    } else {
                        this.classList.remove('is-invalid');
                    }
                }
            });

            // Form reset handler
            form.addEventListener('reset', function () {
                // Reset all invalid states
                document.querySelectorAll('.is-invalid').forEach(el => {
                    el.classList.remove('is-invalid');
                });

                // Reset address checkbox
                sameAsPermanentCheckbox.checked = false;
                correspondenceAddressSection.style.opacity = '1';
                correspondenceAddress.disabled = false;

                // Hide preview images and PDF previews
                document.querySelectorAll('.upload-preview').forEach(preview => {
                    preview.style.display = 'none';
                    preview.src = '';
                });

                document.querySelectorAll('.pdf-preview').forEach(preview => {
                    preview.style.display = 'none';
                });

                // Reset upload text
                document.querySelectorAll('.file-upload p').forEach(p => {
                    if (p.textContent.includes('File selected:')) {
                        if (p.parentElement.id === 'aadharUpload') {
                            p.textContent = 'Click to upload Aadhar';
                        } else if (p.parentElement.id === 'panUpload') {
                            p.textContent = 'Click to upload PAN';
                        } else if (p.parentElement.id === 'signatureUpload') {
                            p.textContent = 'Click to upload Signature';
                        } else if (p.parentElement.id === 'photoUpload') {
                            p.textContent = 'Click to upload Photo';
                        }
                    }
                });

                // Reset border colors
                document.querySelectorAll('.file-upload').forEach(upload => {
                    upload.style.borderColor = '';
                });
            });

            // Initialize all previews as hidden on page load
            document.querySelectorAll('.upload-preview').forEach(preview => {
                preview.style.display = 'none';
            });

            document.querySelectorAll('.pdf-preview').forEach(preview => {
                preview.style.display = 'none';
            });

            async function generatePdfThumbnail(file, pdfPreviewElement, pdfNameElement, fileName) {
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;

                    // Get number of pages
                    const numPages = pdf.numPages;

                    const pdfPreview = document.getElementById(pdfPreviewElement);
                    const pdfName = document.getElementById(pdfNameElement);

                    // Clear and setup preview container
                    pdfPreview.innerHTML = '';
                    pdfPreview.style.display = 'block';
                    pdfPreview.style.maxHeight = '150px'; // Match image preview height
                    pdfPreview.style.overflowY = 'auto'; // Add scroll for multiple pages
                    pdfPreview.style.padding = '10px';
                    pdfPreview.style.backgroundColor = '#f8f9fa';
                    pdfPreview.style.borderRadius = '6px';
                    pdfPreview.style.border = '1px solid #dee2e6';

                    // Create a container for all pages
                    const pagesContainer = document.createElement('div');
                    pagesContainer.className = 'pdf-pages-container';

                    // Render first page (or first few pages for preview)
                    const maxPreviewPages = Math.min(3, numPages); // Show max 3 pages in preview

                    for (let i = 1; i <= maxPreviewPages; i++) {
                        const page = await pdf.getPage(i);
                        const viewport = page.getViewport({ scale: 0.3 }); // Smaller scale to fit

                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');

                        // Set canvas dimensions to match viewport
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;

                        const renderContext = {
                            canvasContext: context,
                            viewport: viewport
                        };

                        await page.render(renderContext).promise;

                        // Add canvas to container
                        const pageDiv = document.createElement('div');
                        pageDiv.className = 'pdf-page mb-2';
                        pageDiv.appendChild(canvas);

                        // Add page number
                        if (maxPreviewPages > 1) {
                            const pageLabel = document.createElement('div');
                            pageLabel.className = 'small text-center text-muted';
                            pageLabel.textContent = `Page ${i}`;
                            pageDiv.appendChild(pageLabel);
                        }

                        pagesContainer.appendChild(pageDiv);
                    }

                    pdfPreview.appendChild(pagesContainer);

                    // Add file info at bottom
                    const fileInfo = document.createElement('div');
                    fileInfo.className = 'pdf-file-info mt-2 pt-2 border-top';

                    const fileNameEl = document.createElement('p');
                    fileNameEl.className = 'mb-1 small text-truncate';
                    fileNameEl.textContent = fileName;
                    fileInfo.appendChild(fileNameEl);

                    const pageCount = document.createElement('p');
                    pageCount.className = 'mb-0 small text-muted';
                    pageCount.textContent = `${numPages} page${numPages > 1 ? 's' : ''}`;
                    fileInfo.appendChild(pageCount);

                    pdfPreview.appendChild(fileInfo);

                } catch (error) {
                    console.error('Error generating PDF thumbnail:', error);
                    // Fallback to icon view
                    const pdfPreview = document.getElementById(pdfPreviewElement);
                    const pdfName = document.getElementById(pdfNameElement);

                    pdfPreview.innerHTML = `
                        <div class="text-center py-3">
                            <i class="bi bi-filetype-pdf pdf-icon"></i>
                            <p class="mb-1 mt-2 small text-truncate">${fileName}</p>
                            <span class="badge bg-danger small">PDF</span>
                        </div>
                    `;
                    pdfPreview.style.display = 'block';
                    pdfPreview.style.maxHeight = '150px';
                }
            }
        });
    </script>
</body>

</html>