<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-11316670180"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'AW-11316670180');
    </script>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>RSSI - Donate Now & Generate Receipt</title>
    <meta name="description"
        content="Make a secure donation to RSSI NGO and instantly generate your receipt. Your contribution helps promote education, community development, and social welfare initiatives.">

    <meta name="keywords"
        content="donate to RSSI NGO, NGO donation, support education NGO, charity donation India, donate for social welfare, nonprofit donation, RSSI donation portal, donation receipt">

    <meta name="author" content="RSSI NGO">
    <meta property="og:image" content="https://rssi.in/img/og_image.png">

    <!-- Favicons -->
    <link href="/img/favicon.ico" rel="icon">
    <link href="/img/apple-touch-icon.png" rel="apple-touch-icon">

    <!-- Vendor CSS Files -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Template Main CSS File -->
    <link href="/css/main.css?v=7.0.0" rel="stylesheet">

    <style>
        .required-asterisk {
            color: red;
        }

        .donation-step {
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            background-color: #f8f9fa;
        }

        .step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            background-color: #0d6efd;
            color: white;
            border-radius: 50%;
            margin-right: 10px;
            font-weight: bold;
        }

        .payment-options {
            margin: 30px 0;
        }

        .payment-method {
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .payment-method:hover {
            border-color: #0d6efd;
            background-color: #f0f7ff;
        }

        .payment-method.active {
            border-color: #0d6efd;
            background-color: #e7f1ff;
        }

        .qr-code-container {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .bank-details {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .donation-form-section {
            display: none;
        }

        .donation-form-section.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .form-progress {
            margin: 30px 0;
        }

        .progress-bar {
            transition: width 0.5s ease;
        }

        .step {
            text-align: center;
            position: relative;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            line-height: 40px;
            border-radius: 50%;
            background-color: #e9ecef;
            color: #6c757d;
            margin: 0 auto 10px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .step-circle.active {
            background-color: #0d6efd;
            color: white;
        }

        .step-label {
            font-size: 0.9rem;
            color: #6c757d;
        }

        .step-label.active {
            color: #0d6efd;
            font-weight: 600;
        }

        /* New styles for donor type cards */
        .donor-type-card {
            cursor: pointer;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 25px 20px;
            text-align: center;
            transition: all 0.3s ease;
            height: 100%;
            background-color: white;
        }

        .donor-type-card:hover {
            border-color: #0d6efd;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .donor-type-card.active {
            border-color: #0d6efd;
            background-color: #f0f7ff;
            box-shadow: 0 5px 15px rgba(13, 110, 253, 0.1);
        }

        .donor-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #0d6efd;
        }

        .donor-type-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .donor-type-desc {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0;
        }

        /* Hide the original select dropdown */
        .donor-type-select {
            display: none;
        }

        .qr-code-wrapper {
            position: relative;
            display: inline-block;
        }

        .qr-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .qr-overlay.show {
            opacity: 1;
            visibility: visible;
        }
    </style>
</head>

<body>

    <!-- ======= Header ======= -->
    <div id="header"></div>
    <!-- End Header -->

    <main id="main">

        <!-- ======= Breadcrumbs ======= -->
        <div class="breadcrumbs">
            <div class="container">
                <div class="d-flex justify-content-between align-items-center">
                    <h2 id="page-title"></h2>
                    <ol id="breadcrumb-list"></ol>
                </div>
            </div>
        </div>
        <!-- End Breadcrumbs -->

        <section class="sample-page">
            <div class="container" data-aos="fade-up">
                <div class="text-center mb-5">
                    <h2>Donate in 3 Simple Steps</h2>
                    <p class="lead">Your contribution can change lives. Complete your donation and get instant receipt.
                    </p>
                </div>

                <!-- Progress Bar -->
                <div class="form-progress">
                    <div class="d-flex justify-content-between mb-2">
                        <div class="step">
                            <div class="step-circle active">1</div>
                            <div class="step-label active">Make Payment</div>
                        </div>
                        <div class="step">
                            <div class="step-circle">2</div>
                            <div class="step-label">Enter Details</div>
                        </div>
                        <div class="step">
                            <div class="step-circle">3</div>
                            <div class="step-label">Get Receipt</div>
                        </div>
                    </div>
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" style="width: 33%" id="progressBar"></div>
                    </div>
                </div>

                <!-- Step 1: Payment Method -->
                <div class="donation-form-section active" id="step1">
                    <div class="donation-step">
                        <h4><span class="step-number">1</span> Make Your Payment</h4>
                        <p>Transfer your donation using any of these methods:</p>

                        <div class="row">
                            <div class="col-lg-6">
                                <div class="bank-details mb-4">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h5 class="mb-0">Bank Transfer</h5>
                                        <div class="copy-buttons">
                                            <button class="btn btn-sm btn-outline-secondary copy-btn" data-copy="all">
                                                <i class="bi bi-clipboard"></i> Copy All
                                            </button>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <p style="line-height: 2;">Account Number: <b>004201033772</b><br> A/C Name:
                                            RINA
                                            SHIKSHA SAHAYAK FOUNDATION<br> Bank Name: ICICI Bank - KOLKATA - SALT LAKE
                                            (Branch Code: 0042)<br> IFSC Code: ICIC0000042</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="qr-code-container">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h5 class="mb-0">UPI Payment</h5>
                                        <div class="qr-actions">
                                            <button class="btn btn-sm btn-outline-primary" id="downloadQR">
                                                <i class="bi bi-download"></i> Save QR
                                            </button>
                                        </div>
                                    </div>

                                    <div class="qr-code-wrapper position-relative mb-3">
                                        <img src="/img/payment.jpg" alt="UPI QR Code" class="img-fluid"
                                            style="max-width: 220px;" id="qrImage">
                                        <div class="qr-overlay" id="qrOverlay">
                                            <div class="text-center">
                                                <i class="bi bi-check-circle-fill text-success"
                                                    style="font-size: 2rem;"></i>
                                                <p class="mt-2 mb-0 fw-bold">QR Code Downloaded!</p>
                                            </div>
                                        </div>
                                    </div>

                                    <p class="text-muted mb-3">Scan with any UPI app such as Google Pay, PhonePe, Paytm,
                                        BHIM, or your bank’s UPI app.</p>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-info mt-4">
                            <i class="bi bi-info-circle"></i>
                            <strong>Important:</strong> After making the payment, please save your Transaction ID/UTR
                            number. You'll need it in the next step to generate your receipt.
                        </div>

                        <div class="text-center mt-4">
                            <button class="btn btn-primary btn-lg" onclick="nextStep(2)">
                                I've Made Payment, Continue to Receipt <i class="bi bi-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Donation Information -->
                <div class="donation-form-section" id="step2">
                    <div class="donation-step">
                        <h4><span class="step-number">2</span> Enter Donation Details</h4>
                        <p>Fill in your details to generate the receipt.</p>

                        <form action="donation_form.php" method="POST" name="donationInfoForm" id="donationInfoForm">
                            <input type="hidden" name="form-type" value="donation_form">

                            <!-- Donor Type Selection - NEW CARD-BASED UI -->
                            <div class="mb-4">
                                <label class="form-label mb-3"><strong>Have you donated earlier?</strong></label>

                                <!-- Hidden select field (still required for form submission) -->
                                <select class="form-select donor-type-select" id="donationType" name="donationType"
                                    required>
                                    <option value="">Select</option>
                                    <option value="new">No, I am a first-time donor</option>
                                    <option value="existing">Yes, I have donated earlier</option>
                                </select>

                                <!-- Card-based UI -->
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <div class="donor-type-card" data-value="new" onclick="selectDonorType('new')">
                                            <div class="donor-icon">
                                                <i class="bi bi-person-plus"></i>
                                            </div>
                                            <div class="donor-type-title">
                                                First Time Donor
                                            </div>
                                            <p class="donor-type-desc">
                                                I'm donating for the first time to RSSI
                                            </p>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="donor-type-card" data-value="existing"
                                            onclick="selectDonorType('existing')">
                                            <div class="donor-icon">
                                                <i class="bi bi-person-check"></i>
                                            </div>
                                            <div class="donor-type-title">
                                                Returning Donor
                                            </div>
                                            <p class="donor-type-desc">
                                                I've donated to RSSI before
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Existing Donor Verification -->
                            <div id="existingDonorInfo" style="display: none;">
                                <div class="card mb-4">
                                    <div class="card-body">
                                        <h5 class="card-title">Find Your Details</h5>
                                        <div class="input-group mb-3">
                                            <input type="text" class="form-control" id="contactnumber_verify"
                                                name="contactnumber_verify" pattern="[0-9]{10}"
                                                placeholder="Enter your 10-digit contact number"
                                                oninput="validateContactNumber(this)">
                                            <button type="button" class="btn btn-primary" id="verifybutton"
                                                onclick="handleVerifyButtonClick(event)" disabled>Find your
                                                details</button>
                                        </div>
                                        <span id="contactnumber_error" style="color: red;"></span>
                                    </div>
                                </div>

                                <!-- Verification Result -->
                                <div id="verificationResult" style="display: none;">
                                    <input type="hidden" id="tel" name="tel" class="form-control" readonly>
                                    <div class="card mb-3">
                                        <div class="card-body">
                                            <h5 class="card-title">Your Details</h5>
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label for="donorName" class="form-label">Donor Name</label>
                                                    <input type="text" id="donorName" class="form-control" readonly>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label for="donorEmail" class="form-label">Email Address</label>
                                                    <input type="email" id="donorEmail" class="form-control" readonly>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- New Donor Information -->
                            <div id="newDonorInfo" style="display: none;">
                                <div class="card mb-4">
                                    <div class="card-body">
                                        <h5 class="card-title">Your Information</h5>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="fullName" class="form-label">Full Name <span
                                                        class="required-asterisk">*</span></label>
                                                <input type="text" class="form-control" id="fullName" name="fullName"
                                                    placeholder="Full name as per PAN card for receipt" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="email" class="form-label">Email Address <span
                                                        class="required-asterisk">*</span></label>
                                                <input type="email" class="form-control" id="email" name="email"
                                                    placeholder="We'll send your donation receipt here" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="contactNumberNew" class="form-label">Contact Number <span
                                                        class="required-asterisk">*</span></label>
                                                <input type="tel" class="form-control" id="contactNumberNew"
                                                    name="contactNumberNew" pattern="[0-9]{10}"
                                                    placeholder="10-digit number, no country code needed" required>
                                                <small id="contactNumberError" class="form-text text-danger"></small>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="idNumber" class="form-label">PAN Number</label>
                                                <input type="text" class="form-control" id="idNumber" name="idNumber"
                                                    placeholder="Required for 80G tax exemption in India">
                                            </div>
                                            <div class="col-12 mb-3">
                                                <label for="postalAddress" class="form-label">Postal Address <span
                                                        class="required-asterisk">*</span></label>
                                                <textarea class="form-control" id="postalAddress" name="postalAddress"
                                                    rows="3" required></textarea>
                                            </div>
                                        </div>
                                        <div class="alert alert-info mt-3">
                                            <i class="bi bi-info-circle"></i>
                                            Please note that if you do not provide your PAN Number, you will not be able
                                            to claim 50% tax exemption u/s 80G in India
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Donation Amount Section (Shows after donor type selection) -->
                            <div id="donationamount" style="display: none;">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">Payment Details</h5>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="donationAmount" class="form-label">Donation Amount <span
                                                        class="required-asterisk">*</span></label>
                                                <div class="input-group">
                                                    <select class="form-select" id="currency" name="currency" required>
                                                        <option value="" selected>Select Currency</option>
                                                        <option value="INR">INR</option>
                                                    </select>
                                                    <input type="number" class="form-control" id="donationAmount"
                                                        name="donationAmount" min="500" step="any"
                                                        placeholder="Minimum ₹500" required>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="transactionid" class="form-label">Transaction ID/UTR <span
                                                        class="required-asterisk">*</span></label>
                                                <input type="text" class="form-control" id="transactionid"
                                                    name="transactionid" placeholder="From your bank/UPI app" required>
                                            </div>
                                            <div class="col-12 mb-3">
                                                <label for="message" class="form-label">Message (Optional)</label>
                                                <textarea class="form-control" id="message" name="message" rows="3"
                                                    placeholder="Any special instructions or dedication..."></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="d-flex justify-content-between mt-4">
                                    <button type="button" class="btn btn-outline-secondary" onclick="prevStep(1)">
                                        <i class="bi bi-arrow-left"></i> Back to Payment
                                    </button>
                                    <button type="submit" class="btn btn-primary btn-lg" id="donateButton" disabled>
                                        Submit <i class="bi bi-send"></i>
                                    </button>
                                </div>
                            </div>
                        </form>

                        <!-- Hidden form for verification -->
                        <form name="get_details_form" id="get_details_form" action="#" method="POST"
                            style="display: none;">
                            <input type="hidden" name="form-type" value="get_details">
                            <input type="hidden" name="contactnumber_verify_input">
                        </form>
                    </div>
                </div>

                <!-- Step 3: Get Receipt (Initially hidden) -->
                <div class="donation-form-section" id="step3">
                    <div class="donation-step">
                        <div class="text-center py-5">
                            <div id="confirmationContent">
                                <!-- Content will be populated dynamically -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Bootstrap Modal for submission progress -->
        <div class="modal fade" id="submissionModal" tabindex="-1" aria-labelledby="submissionModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-body">
                        <div class="text-center">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-3">Submission in progress. Please do not close or reload this page.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>
    <!-- End #main -->

    <!-- ======= Footer ======= -->
    <div id="footer"></div>
    <!-- End Footer -->

    <a href="#" class="scroll-top d-flex align-items-center justify-content-center">
        <i class="bi bi-arrow-up-short"></i>
    </a>

    <!-- Vendor JS Files -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>

    <!-- Load jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="/js/main.js?v=7.0.0"></script>

    <script>
        // Progress tracking
        let currentStep = 1;

        function updateProgressBar(step) {
            const progress = (step / 3) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;

            document.querySelectorAll('.step').forEach((stepEl, index) => {
                const circle = stepEl.querySelector('.step-circle');
                const label = stepEl.querySelector('.step-label');

                if (!circle || !label) return; // safety guard

                if (index + 1 <= step) {
                    circle.classList.add('active');
                    label.classList.add('active');
                } else {
                    circle.classList.remove('active');
                    label.classList.remove('active');
                }
            });
        }

        function nextStep(step) {
            document.querySelectorAll('.donation-form-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(`step${step}`).classList.add('active');
            currentStep = step;
            updateProgressBar(step);
        }

        function prevStep(step) {
            nextStep(step);
        }

        // ========== NEW FUNCTION FOR CARD-BASED SELECTION ==========
        function selectDonorType(type) {
            // Update the hidden select field
            const donationTypeSelect = document.getElementById('donationType');
            donationTypeSelect.value = type;

            // Update card UI
            document.querySelectorAll('.donor-type-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelector(`.donor-type-card[data-value="${type}"]`).classList.add('active');

            // Trigger the original toggle function
            toggleDonorSections();
        }

        // ========== YOUR ORIGINAL LOGIC STARTS HERE ==========

        // Determine the correct script URL based on the environment
        const scriptURL = window.location.hostname === 'localhost'
            ? 'http://localhost:8082/rssi-member/payment-api.php'
            : 'https://login.rssi.in/rssi-member/payment-api.php';

        // Contact number validation for existing donor
        function validateContactNumber(input) {
            var errorMessage = document.getElementById("contactnumber_error");
            var verifyButton = document.getElementById("verifybutton");

            if (!input.checkValidity() || input.value.trim() === '') {
                errorMessage.textContent = "Please enter a valid 10-digit contact number.";
                verifyButton.disabled = true;
            } else {
                errorMessage.textContent = "";
                verifyButton.disabled = false;
            }
        }

        // Contact number validation for new donor
        function validateContactNumberNew() {
            const inputElement = document.getElementById('contactNumberNew');
            const errorElement = document.getElementById('contactNumberError');

            if (inputElement.validity.patternMismatch) {
                errorElement.textContent = 'Please enter a valid 10-digit number.';
            } else {
                errorElement.textContent = '';
            }
        }

        // Initialize contact number validation
        document.addEventListener('DOMContentLoaded', function () {
            const contactNumberNewInput = document.getElementById('contactNumberNew');
            if (contactNumberNewInput) {
                contactNumberNewInput.addEventListener('input', validateContactNumberNew);
            }

            // Initialize verify button as disabled
            const verifyButton = document.getElementById('verifybutton');
            if (verifyButton) {
                verifyButton.disabled = true;
            }

            // Validate contact number on page load for existing field
            const contactNumberInput = document.getElementById('contactnumber_verify');
            if (contactNumberInput) {
                validateContactNumber(contactNumberInput);
            }
        });

        // Toggle donor sections based on donation type - KEPT ORIGINAL
        function toggleDonorSections() {
            const donationType = document.getElementById('donationType').value;
            const existingDonorInfo = document.getElementById('existingDonorInfo');
            const newDonorInfo = document.getElementById('newDonorInfo');
            const verificationResult = document.getElementById('verificationResult');
            const donationAmountSection = document.getElementById('donationamount');
            const donateButton = document.getElementById('donateButton');
            const contactNumberInput = document.getElementById('contactnumber_verify');
            const verifyButton = document.getElementById('verifybutton');

            if (donationType === 'existing') {
                existingDonorInfo.style.display = 'block';
                newDonorInfo.style.display = 'none';
                verificationResult.style.display = 'none';
                donationAmountSection.style.display = 'none';
                donateButton.disabled = true;

                // Reset contact number field and button if they were disabled from previous verification
                if (contactNumberInput) {
                    contactNumberInput.disabled = false;
                    contactNumberInput.removeAttribute('readonly');
                    contactNumberInput.value = '';
                    validateContactNumber(contactNumberInput); // Re-validate empty field
                }
                if (verifyButton) {
                    verifyButton.disabled = true; // Disabled initially
                    verifyButton.innerHTML = 'Find your details';
                    verifyButton.classList.remove('btn-success');
                    verifyButton.classList.add('btn-primary');
                }
            } else if (donationType === 'new') {
                existingDonorInfo.style.display = 'none';
                newDonorInfo.style.display = 'block';
                verificationResult.style.display = 'none';
                donationAmountSection.style.display = 'block';
                donateButton.disabled = false;
            } else {
                existingDonorInfo.style.display = 'none';
                newDonorInfo.style.display = 'none';
                verificationResult.style.display = 'none';
                donationAmountSection.style.display = 'none';
                donateButton.disabled = true;
            }

            // Handle required fields based on donation type
            handleDonationTypeChange();
        }

        // Handle required fields based on donation type - KEPT ORIGINAL
        function handleDonationTypeChange() {
            const donationType = document.getElementById("donationType").value;
            const fullNameInput = document.getElementById("fullName");
            const emailInput = document.getElementById("email");
            const contactNumberNewInput = document.getElementById("contactNumberNew");
            const idNumberInput = document.getElementById("idNumber");
            const postalAddressInput = document.getElementById("postalAddress");

            // Set required attribute based on the donation type
            if (donationType === "existing") {
                fullNameInput.removeAttribute("required");
                emailInput.removeAttribute("required");
                contactNumberNewInput.removeAttribute("required");
                idNumberInput.removeAttribute("required");
                postalAddressInput.removeAttribute("required");
            } else if (donationType === "new") {
                fullNameInput.setAttribute("required", true);
                emailInput.setAttribute("required", true);
                contactNumberNewInput.setAttribute("required", true);
                idNumberInput.removeAttribute("required");
                postalAddressInput.setAttribute("required", true);
            }
        }

        // Verify existing donor - KEPT ORIGINAL
        async function handleVerifyButtonClick(event) {
            event.preventDefault();

            const contactNumberInput = document.getElementById("contactnumber_verify");
            const contactNumberVerifyInput = document.getElementsByName("contactnumber_verify_input")[0];
            const donorNameInput = document.getElementById("donorName");
            const donorEmailInput = document.getElementById("donorEmail");
            const telInput = document.getElementById("tel");
            const verificationResultDiv = document.getElementById("verificationResult");
            const donationamount = document.getElementById('donationamount');
            const donateButton = document.getElementById('donateButton');
            const verifyButton = document.getElementById("verifybutton");

            // Don't proceed if button is disabled
            if (verifyButton.disabled) return;

            // Save original button text
            const originalText = verifyButton.innerHTML;

            // Disable button and show spinner
            verifyButton.disabled = true;
            verifyButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Finding...';

            // Set the contact number in the hidden form
            contactNumberVerifyInput.value = contactNumberInput.value;

            try {
                const response = await fetch(scriptURL, {
                    method: 'POST',
                    body: new FormData(document.forms['get_details_form'])
                });

                const data = await response.json();

                if (data.status === 'success') {
                    donorNameInput.value = data.data.fullname;
                    donorEmailInput.value = data.data.email;
                    telInput.value = data.data.tel;
                    verificationResultDiv.style.display = "block";
                    donationamount.style.display = 'block';
                    donateButton.disabled = false;

                    // Show success message
                    alert("User data fetched successfully!");

                    // Disable the contact number input and button after successful verification
                    contactNumberInput.disabled = true;
                    verifyButton.disabled = true;
                    verifyButton.innerHTML = '<i class="bi bi-check-circle"></i> Verified';
                    verifyButton.classList.remove('btn-primary');
                    verifyButton.classList.add('btn-success');
                } else if (data.status === 'no_records') {
                    verificationResultDiv.style.display = "none";
                    donationamount.style.display = 'none';
                    donateButton.disabled = true;
                    donorNameInput.value = "";
                    donorEmailInput.value = "";
                    telInput.value = "";

                    alert("No records found in the database. Please donate as a new user.");

                    // Reset button to original state
                    verifyButton.disabled = false;
                    verifyButton.innerHTML = originalText;
                } else {
                    console.log('Error:', data.message);
                    alert("Error retrieving user data. Please try again later or contact support.");

                    // Reset button to original state
                    verifyButton.disabled = false;
                    verifyButton.innerHTML = originalText;
                }
            } catch (error) {
                console.log('Error:', error);
                alert("Error fetching user data. Please try again later or contact support.");

                // Reset button to original state on error
                verifyButton.disabled = false;
                verifyButton.innerHTML = originalText;
            }
        }

        // Form submission - KEPT ORIGINAL
        document.getElementById("donationInfoForm").addEventListener("submit", async function (event) {
            event.preventDefault();

            if (!this.checkValidity()) {
                this.reportValidity();
                return;
            }

            // Disable the donate button immediately upon form submission
            const donateButton = document.getElementById('donateButton');
            donateButton.disabled = true;
            donateButton.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Submitting...';

            // Show the submission modal
            const submissionModal = new bootstrap.Modal(document.getElementById('submissionModal'), {
                backdrop: 'static',
                keyboard: false
            });
            submissionModal.show();

            try {
                const response = await fetch(scriptURL, {
                    method: 'POST',
                    body: new FormData(this)
                });
                const result = await response.json();

                console.log("API Response:", result);

                // Hide the submission modal
                submissionModal.hide();

                // Check if submission was successful
                if (result.error === false) {
                    // Move to step 3 with success message
                    nextStep(3);

                    const confirmationContent = document.getElementById('confirmationContent');
                    const successHtml = `
                        <div class="mb-4">
                            <i class="bi bi-check-circle-fill text-success" style="font-size: 4rem;"></i>
                        </div>
                        <h2>Thank You for Your Donation!</h2>
                        <div class="alert alert-success mx-auto mt-4 mb-4" style="max-width: 600px;">
                            <h4 class="alert-heading">Submitted Successfully!</h4>
                            <p>Your donation has been successfully recorded.</p>
                            <hr>
                            <p class="mb-0"><strong>Donation Reference ID:</strong> ${result.donationId}</p>
                            <p class="mb-0">The original receipt will be shared via post or email within 7 business days.</p>
                        </div>
                        
                        <div class="mt-4">
                            <button class="btn btn-outline-primary" onclick="location.reload()">
                                <i class="bi bi-heart"></i> Make Another Donation
                            </button>
                        </div>
                    `;

                    confirmationContent.innerHTML = successHtml;

                } else {
                    // Show error alert and stay on step 2
                    let errorMessage = "Error occurred during form submission. Please try again later.";

                    if (result.errorMessage === "already_registered") {
                        errorMessage = "Oops! You are already registered in our database. Please donate as an existing donor.";
                    } else if (result.errorMessage) {
                        errorMessage = result.errorMessage;
                    }

                    alert(errorMessage);

                    // Re-enable the submit button
                    donateButton.disabled = false;
                    donateButton.innerHTML = 'Submit <i class="bi bi-send"></i>';
                }
            } catch (error) {
                console.error(error);

                // Hide the submission modal
                submissionModal.hide();

                // Show error alert and stay on step 2
                alert("Error occurred during form submission. Please try again later.");

                // Re-enable the submit button
                donateButton.disabled = false;
                donateButton.innerHTML = 'Submit <i class="bi bi-send"></i>';
            }
        });

        // Initialize donation type change event - MODIFIED FOR CARDS
        document.addEventListener('DOMContentLoaded', function () {
            // Add click event listeners to donor type cards
            document.querySelectorAll('.donor-type-card').forEach(card => {
                card.addEventListener('click', function () {
                    const value = this.getAttribute('data-value');
                    selectDonorType(value);
                });
            });
        });

    </script>

    <!-- Glow Cookies -->
    <script src="https://cdn.jsdelivr.net/gh/manucaralmo/GlowCookies@3.0.1/src/glowCookies.min.js"></script>
    <script>
        glowCookies.start('en', {
            analytics: 'G-S25QWTFJ2S',
            policyLink: 'disclaimer'
        });
    </script>
    <script>
        // Copy to clipboard functionality
        document.addEventListener('DOMContentLoaded', function () {
            // Copy individual buttons
            document.querySelectorAll('.copy-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const type = this.getAttribute('data-copy');
                    let textToCopy = '';

                    if (type === 'all') {
                        // Copy all bank details
                        textToCopy =
                            `Account Number: 004201033772\n` +
                            `A/C Name: RINA SHIKSHA SAHAYAK FOUNDATION\n` +
                            `Bank Name: ICICI Bank - KOLKATA - SALT LAKE (Branch Code: 0042)\n` +
                            `IFSC Code: ICIC0000042`;
                    } else {
                        // Copy specific field
                        const element = document.getElementById(type);
                        if (element) {
                            textToCopy = element.textContent;
                        }
                    }

                    // Copy to clipboard
                    navigator.clipboard.writeText(textToCopy).then(() => {
                        // Show success state
                        const originalHTML = this.innerHTML;
                        this.innerHTML = '<i class="bi bi-check"></i>';
                        this.classList.add('copied');

                        // Revert after 2 seconds
                        setTimeout(() => {
                            this.innerHTML = originalHTML;
                            this.classList.remove('copied');
                        }, 2000);

                        // Show notification for "Copy All"
                        if (type === 'all') {
                            showNotification('All bank details copied to clipboard!');
                        }
                    }).catch(err => {
                        console.error('Failed to copy: ', err);
                        alert('Failed to copy to clipboard. Please try again.');
                    });
                });
            });

            // Download QR Code
            document.getElementById('downloadQR').addEventListener('click', function () {
                const qrImage = document.getElementById('qrImage');
                const qrOverlay = document.getElementById('qrOverlay');

                // Create a temporary anchor element
                const link = document.createElement('a');
                link.href = qrImage.src;
                link.download = 'RSSI_Donation_QR_Code.jpg';
                link.click();

                // Show success overlay
                qrOverlay.classList.add('show');

                // Hide overlay after 2 seconds
                setTimeout(() => {
                    qrOverlay.classList.remove('show');
                }, 2000);
            });

            // UPI app click effect
            document.querySelectorAll('.upi-app').forEach(app => {
                app.addEventListener('click', function () {
                    const appName = this.querySelector('small').textContent;
                    showNotification(`Open ${appName} and scan the QR code`);

                    // Add visual feedback
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 200);
                });
            });
        });

        function showNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = 'notification alert alert-success';
            notification.innerHTML = `
            <i class="bi bi-check-circle me-2"></i>
            ${message}
        `;
            notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            animation: slideIn 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        `;

            // Add to body
            document.body.appendChild(notification);

            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        .notification {
            max-width: 350px;
        }
    `;
        document.head.appendChild(style);
    </script>
</body>

</html>